# Snapshot report for `test/codegen.js`

The actual snapshot is saved in `codegen.js.snap`.

Generated by [AVA](https://ava.li).

## generates a nicely indented module

> Snapshot 1

    `"use strict"␊
    ␊
    const process = require("process")␊
    const merge = require("~/node_modules/lodash.merge/index.js")␊
    const cloneOptions = require("~/build/cloneOptions.js").default␊
    const normalizeSomeOptions = require("~/build/normalizeOptions.js").default␊
    const standardizeName = require("~/build/standardizeName.js").default␊
    ␊
    function resolvePluginOrPreset (resolutionCache, kind, ref) {␊
      const name = standardizeName(kind, ref).name␊
      if (!resolutionCache.has(name)) throw new Error(`Could not find previously resolved ${kind} in cache`)␊
      return resolutionCache.get(name)␊
    }␊
    ␊
    function normalizePluginsAndPresets (resolutionCache, options) {␊
      if (Array.isArray(options.plugins)) {␊
        options.plugins = options.plugins.map(ref => {␊
          if (typeof ref === 'string') {␊
            ref = resolvePluginOrPreset(resolutionCache, "plugin", ref)␊
          } else if (Array.isArray(ref) && typeof ref[0] === 'string') {␊
            ref[0] = resolvePluginOrPreset(resolutionCache, "plugin", ref[0])␊
          }␊
          return ref␊
        })␊
      } else {␊
        delete options.plugins␊
      }␊
      if (Array.isArray(options.presets)) {␊
        options.presets = options.presets.map(ref => {␊
          if (typeof ref === 'string') {␊
            ref = resolvePluginOrPreset(resolutionCache, "preset", ref)␊
          } else if (Array.isArray(ref) && typeof ref[0] === 'string') {␊
            ref[0] = resolvePluginOrPreset(resolutionCache, "preset", ref[0])␊
          }␊
          return ref␊
        })␊
      } else {␊
        delete options.presets␊
      }␊
      return options␊
    }␊
    ␊
    function loadCachedModule (cache, dir, source, envName, selectEnv) {␊
      if (!cache) throw new Error(`A cache is required to load the configuration module at '${source}'`)␊
    ␊
      const cached = cache.moduleSources.get(source)␊
      if (!cached) throw new Error(`Could not find the configuration module for '${source}' in the cache`)␊
      if (!cached.unrestricted && !cached.byEnv.has(envName)) throw new Error(`Could not find the configuration module, specific to the '${envName}' environment, for '${source}', in the cache`)␊
    ␊
      let options = cloneOptions(cached.unrestricted ? cached.options : cached.byEnv.get(envName).options)␊
      if (selectEnv) options = options.env[envName]␊
      delete options.env␊
      delete options.extends␊
      normalizeSomeOptions(options)␊
      normalizePluginsAndPresets(cache.pluginsAndPresets.get(dir), options)␊
      return options␊
    }␊
    ␊
    function mergeConfigs (configs) {␊
      return configs.reduce((target, config) => {␊
        const plugins = config.plugins␊
        const presets = config.presets␊
    ␊
        delete config.plugins␊
        delete config.presets␊
    ␊
        if (plugins) {␊
          target.plugins = target.plugins␊
            ? target.plugins.concat(plugins)␊
            : plugins␊
        }␊
        if (presets) {␊
          target.presets = target.presets␊
            ? target.presets.concat(presets)␊
            : presets␊
        }␊
        return merge(target, config)␊
      })␊
    }␊
    ␊
    const defaultOptions = (envName, cache) => {␊
      return Object.assign(mergeConfigs([␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, false),␊
        {␊
          sourceMaps: false,␊
          plugins: [␊
            [␊
              "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              {␊
                label: "plugin@babelrc"␊
              },␊
              "plugin@babelrc"␊
            ]␊
          ],␊
          presets: [␊
            [␊
              "~/test/fixtures/compare/node_modules/preset/index.js",␊
              {␊
                label: "preset@babelrc"␊
              },␊
              "preset@babelrc"␊
            ]␊
          ]␊
        }␊
      ]), {babelrc: false, envName})␊
    }␊
    ␊
    const envOptions = Object.create(null)␊
    ␊
    envOptions["foo"] = (envName, cache) => {␊
      return Object.assign(mergeConfigs([␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, false),␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, true),␊
        {␊
          sourceMaps: false,␊
          plugins: [␊
            [␊
              "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              {␊
                label: "plugin@babelrc"␊
              },␊
              "plugin@babelrc"␊
            ],␊
            [␊
              "~/test/fixtures/compare/node_modules/env-plugin/index.js",␊
              {␊
                label: "plugin@babelrc.foo"␊
              },␊
              "plugin@babelrc.foo"␊
            ],␊
            "~/test/fixtures/compare/node_modules/plugin-default-opts/index.js"␊
          ],␊
          presets: [␊
            [␊
              "~/test/fixtures/compare/node_modules/preset/index.js",␊
              {␊
                label: "preset@babelrc"␊
              },␊
              "preset@babelrc"␊
            ],␊
            [␊
              "~/test/fixtures/compare/node_modules/preset/index.js",␊
              {␊
                label: "preset@babelrc.foo"␊
              },␊
              "preset@babelrc.foo"␊
            ]␊
          ]␊
        }␊
      ]), {babelrc: false, envName})␊
    }␊
    ␊
    exports.getOptions = (envName, cache) => {␊
      if (typeof envName !== "string") {␊
        envName = process.env.BABEL_ENV || process.env.NODE_ENV || "development"␊
      }␊
      return envName in envOptions␊
        ? envOptions[envName](envName, cache)␊
        : defaultOptions(envName, cache)␊
    }␊
    `

# Snapshot report for `test/codegen.js`

The actual snapshot is saved in `codegen.js.snap`.

Generated by [AVA](https://ava.li).

## generates a nicely indented module

> Snapshot 1

    `"use strict"âŠ
    âŠ
    const process = require("process")âŠ
    const merge = require("~/node_modules/lodash.merge/index.js")âŠ
    const cloneOptions = require("~/build/cloneOptions.js").defaultâŠ
    const getPluginOrPresetName = require("~/build/getPluginOrPresetName.js").defaultâŠ
    const mergePluginsOrPresets = require("~/build/mergePluginsOrPresets.js").defaultâŠ
    const normalizeSomeOptions = require("~/build/normalizeOptions.js").defaultâŠ
    const standardizeName = require("~/build/standardizeName.js").defaultâŠ
    âŠ
    function resolvePluginOrPreset (resolutionCache, kind, ref) {âŠ
      const name = standardizeName(kind, ref).nameâŠ
      if (!resolutionCache.has(name)) throw new Error(`Could not find previously resolved ${kind} in cache`)âŠ
      return resolutionCache.get(name)âŠ
    }âŠ
    âŠ
    function normalizePluginsAndPresets (resolutionCache, nameMap, options) {âŠ
      if (Array.isArray(options.plugins)) {âŠ
        options.plugins = options.plugins.map(item => {âŠ
          if (Array.isArray(item)) {âŠ
            const target = item[0]âŠ
            if (typeof target !== 'string') {âŠ
              return {target, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, target)}âŠ
            }âŠ
    âŠ
            const filename = resolvePluginOrPreset(resolutionCache, "plugin", target)âŠ
            return {filename, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, filename)}âŠ
          }âŠ
          if (typeof item === 'string') {âŠ
            const filename = resolvePluginOrPreset(resolutionCache, "plugin", item)âŠ
            return {filename, name: getPluginOrPresetName(nameMap, filename)}âŠ
          }âŠ
          return {target: item, name: getPluginOrPresetName(nameMap, item)}âŠ
        })âŠ
      } else {âŠ
        options.plugins = []âŠ
      }âŠ
      if (Array.isArray(options.presets)) {âŠ
        options.presets = options.presets.map(item => {âŠ
          if (Array.isArray(item)) {âŠ
            const target = item[0]âŠ
            if (typeof target !== 'string') {âŠ
              return {target, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, target)}âŠ
            }âŠ
    âŠ
            const filename = resolvePluginOrPreset(resolutionCache, "preset", target)âŠ
            return {filename, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, filename)}âŠ
          }âŠ
          if (typeof item === 'string') {âŠ
            const filename = resolvePluginOrPreset(resolutionCache, "preset", item)âŠ
            return {filename, name: getPluginOrPresetName(nameMap, filename)}âŠ
          }âŠ
          return {target: item, name: getPluginOrPresetName(nameMap, item)}âŠ
        })âŠ
      } else {âŠ
        options.presets = []âŠ
      }âŠ
      return optionsâŠ
    }âŠ
    âŠ
    function loadCachedModule (cache, dir, source, envName, selectOverride, selectEnv) {âŠ
      if (!cache) throw new Error(`A cache is required to load the configuration module at '${source}'`)âŠ
    âŠ
      const cached = cache.moduleSources.get(source)âŠ
      if (!cached) throw new Error(`Could not find the configuration module for '${source}' in the cache`)âŠ
      if (!cached.unrestricted && !cached.byEnv.has(envName)) throw new Error(`Could not find the configuration module, specific to the '${envName}' environment, for '${source}', in the cache`)âŠ
    âŠ
      let options = cloneOptions(cached.unrestricted ? cached.options : cached.byEnv.get(envName).options)âŠ
      if (selectOverride !== undefined) options = options.overrides[selectOverride]âŠ
      if (selectEnv) options = options.env[envName]âŠ
      delete options.envâŠ
      delete options.extendsâŠ
      delete options.overridesâŠ
      normalizeSomeOptions(options)âŠ
      normalizePluginsAndPresets(cache.pluginsAndPresets.get(dir), cache.nameMap, options)âŠ
      return optionsâŠ
    }âŠ
    âŠ
    function arrifyPluginsOrPresets (list) {âŠ
      return list.map(item => ([item.target || item.filename, item.options, item.name]))âŠ
    }âŠ
    âŠ
    function mergeConfigs (configs) {âŠ
      const merged = configs.reduce((target, options) => {âŠ
        const plugins = options.pluginsâŠ
        const presets = options.presetsâŠ
    âŠ
        delete options.pluginsâŠ
        delete options.presetsâŠ
    âŠ
        mergePluginsOrPresets(target.plugins, plugins)âŠ
        mergePluginsOrPresets(target.presets, presets)âŠ
        return merge(target, options)âŠ
      }, {plugins: [], presets: []})âŠ
    âŠ
      if (merged.plugins.length > 0) {âŠ
        merged.plugins = arrifyPluginsOrPresets(merged.plugins)âŠ
      } else {âŠ
        delete merged.pluginsâŠ
      }âŠ
      if (merged.presets.length > 0) {âŠ
        merged.presets = arrifyPluginsOrPresets(merged.presets)âŠ
      } else {âŠ
        delete merged.presetsâŠ
      }âŠ
    âŠ
      return mergedâŠ
    }âŠ
    âŠ
    const defaultOptions = (envName, cache) => {âŠ
      return Object.assign(mergeConfigs([âŠ
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, false),âŠ
        {âŠ
          sourceMaps: false,âŠ
          plugins: [âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.1"âŠ
              },âŠ
              name: "ğŸ¤¡ğŸªğŸŸ.0"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.2"âŠ
              },âŠ
              name: "plugin@babelrc.2"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.3"âŠ
              },âŠ
              name: "plugin@babelrc.3"âŠ
            }âŠ
          ],âŠ
          presets: [âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",âŠ
              options: {âŠ
                label: "preset@babelrc"âŠ
              },âŠ
              name: "preset@babelrc"âŠ
            }âŠ
          ]âŠ
        }âŠ
      ]), {âŠ
        babelrc: false,âŠ
        envName,âŠ
        overrides: [âŠ
    âŠ
        ]âŠ
      })âŠ
    }âŠ
    âŠ
    const envOptions = Object.create(null)âŠ
    âŠ
    envOptions["foo"] = (envName, cache) => {âŠ
      return Object.assign(mergeConfigs([âŠ
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, false),âŠ
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, true),âŠ
        {âŠ
          sourceMaps: false,âŠ
          plugins: [âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.1.foo"âŠ
              },âŠ
              name: "ğŸ¤¡ğŸªğŸŸ.0"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.2.foo"âŠ
              },âŠ
              name: "plugin@babelrc.2"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",âŠ
              options: {âŠ
                label: "plugin@babelrc.3"âŠ
              },âŠ
              name: "plugin@babelrc.3"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/env-plugin/index.js",âŠ
              options: {âŠ
                label: "env-plugin@babelrc.foo"âŠ
              },âŠ
              name: "plugin@babelrc.foo"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/plugin-default-opts/index.js",âŠ
              name: "ğŸ¤¡ğŸªğŸŸ.2"âŠ
            }âŠ
          ],âŠ
          presets: [âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",âŠ
              options: {âŠ
                label: "preset@babelrc"âŠ
              },âŠ
              name: "preset@babelrc"âŠ
            },âŠ
            {âŠ
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",âŠ
              options: {âŠ
                label: "preset@babelrc.foo"âŠ
              },âŠ
              name: "preset@babelrc.foo"âŠ
            }âŠ
          ]âŠ
        }âŠ
      ]), {âŠ
        babelrc: false,âŠ
        envName,âŠ
        overrides: [âŠ
    âŠ
        ]âŠ
      })âŠ
    }âŠ
    âŠ
    exports.getOptions = (envName, cache) => {âŠ
      if (typeof envName !== "string") {âŠ
        envName = process.env.BABEL_ENV || process.env.NODE_ENV || "development"âŠ
      }âŠ
      return envName in envOptionsâŠ
        ? envOptions[envName](envName, cache)âŠ
        : defaultOptions(envName, cache)âŠ
    }âŠ
    `

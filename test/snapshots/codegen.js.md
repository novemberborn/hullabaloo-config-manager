# Snapshot report for `test/codegen.js`

The actual snapshot is saved in `codegen.js.snap`.

Generated by [AVA](https://ava.li).

## generates a nicely indented module

> Snapshot 1

    `"use strict"␊
    ␊
    const process = require("process")␊
    const merge = require("~/node_modules/lodash.merge/index.js")␊
    const cloneOptions = require("~/build/cloneOptions.js").default␊
    const getPluginOrPresetName = require("~/build/getPluginOrPresetName.js").default␊
    const mergePluginsOrPresets = require("~/build/mergePluginsOrPresets.js").default␊
    const normalizeSomeOptions = require("~/build/normalizeOptions.js").default␊
    const standardizeName = require("~/build/standardizeName.js").default␊
    ␊
    function resolvePluginOrPreset (resolutionCache, kind, ref) {␊
      const name = standardizeName(kind, ref).name␊
      if (!resolutionCache.has(name)) throw new Error(`Could not find previously resolved ${kind} in cache`)␊
      return resolutionCache.get(name)␊
    }␊
    ␊
    function normalizePluginsAndPresets (resolutionCache, nameMap, options) {␊
      if (Array.isArray(options.plugins)) {␊
        options.plugins = options.plugins.map(item => {␊
          if (Array.isArray(item)) {␊
            const target = item[0]␊
            if (typeof target !== 'string') {␊
              return {target, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, target)}␊
            }␊
    ␊
            const filename = resolvePluginOrPreset(resolutionCache, "plugin", target)␊
            return {filename, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, filename)}␊
          }␊
          if (typeof item === 'string') {␊
            const filename = resolvePluginOrPreset(resolutionCache, "plugin", item)␊
            return {filename, name: getPluginOrPresetName(nameMap, filename)}␊
          }␊
          return {target: item, name: getPluginOrPresetName(nameMap, item)}␊
        })␊
      } else {␊
        options.plugins = []␊
      }␊
      if (Array.isArray(options.presets)) {␊
        options.presets = options.presets.map(item => {␊
          if (Array.isArray(item)) {␊
            const target = item[0]␊
            if (typeof target !== 'string') {␊
              return {target, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, target)}␊
            }␊
    ␊
            const filename = resolvePluginOrPreset(resolutionCache, "preset", target)␊
            return {filename, options: item[1], name: item.length > 2 ? item[2] : getPluginOrPresetName(nameMap, filename)}␊
          }␊
          if (typeof item === 'string') {␊
            const filename = resolvePluginOrPreset(resolutionCache, "preset", item)␊
            return {filename, name: getPluginOrPresetName(nameMap, filename)}␊
          }␊
          return {target: item, name: getPluginOrPresetName(nameMap, item)}␊
        })␊
      } else {␊
        options.presets = []␊
      }␊
      return options␊
    }␊
    ␊
    function loadCachedModule (cache, dir, source, envName, selectOverride, selectEnv) {␊
      if (!cache) throw new Error(`A cache is required to load the configuration module at '${source}'`)␊
    ␊
      const cached = cache.moduleSources.get(source)␊
      if (!cached) throw new Error(`Could not find the configuration module for '${source}' in the cache`)␊
      if (!cached.unrestricted && !cached.byEnv.has(envName)) throw new Error(`Could not find the configuration module, specific to the '${envName}' environment, for '${source}', in the cache`)␊
    ␊
      let options = cloneOptions(cached.unrestricted ? cached.options : cached.byEnv.get(envName).options)␊
      if (selectOverride !== undefined) options = options.overrides[selectOverride]␊
      if (selectEnv) options = options.env[envName]␊
      delete options.env␊
      delete options.extends␊
      delete options.overrides␊
      normalizeSomeOptions(options)␊
      normalizePluginsAndPresets(cache.pluginsAndPresets.get(dir), cache.nameMap, options)␊
      return options␊
    }␊
    ␊
    function arrifyPluginsOrPresets (list) {␊
      return list.map(item => ([item.target || item.filename, item.options, item.name]))␊
    }␊
    ␊
    function mergeConfigs (configs) {␊
      const merged = configs.reduce((target, options) => {␊
        const plugins = options.plugins␊
        const presets = options.presets␊
    ␊
        delete options.plugins␊
        delete options.presets␊
    ␊
        mergePluginsOrPresets(target.plugins, plugins)␊
        mergePluginsOrPresets(target.presets, presets)␊
        return merge(target, options)␊
      }, {plugins: [], presets: []})␊
    ␊
      if (merged.plugins.length > 0) {␊
        merged.plugins = arrifyPluginsOrPresets(merged.plugins)␊
      } else {␊
        delete merged.plugins␊
      }␊
      if (merged.presets.length > 0) {␊
        merged.presets = arrifyPluginsOrPresets(merged.presets)␊
      } else {␊
        delete merged.presets␊
      }␊
    ␊
      return merged␊
    }␊
    ␊
    const defaultOptions = (envName, cache) => {␊
      return Object.assign(mergeConfigs([␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, false),␊
        {␊
          sourceMaps: false,␊
          plugins: [␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.1"␊
              },␊
              name: "🤡🎪🎟.0"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.2"␊
              },␊
              name: "plugin@babelrc.2"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.3"␊
              },␊
              name: "plugin@babelrc.3"␊
            }␊
          ],␊
          presets: [␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",␊
              options: {␊
                label: "preset@babelrc"␊
              },␊
              name: "preset@babelrc"␊
            }␊
          ]␊
        }␊
      ]), {␊
        babelrc: false,␊
        envName,␊
        overrides: [␊
    ␊
        ]␊
      })␊
    }␊
    ␊
    const envOptions = Object.create(null)␊
    ␊
    envOptions["foo"] = (envName, cache) => {␊
      return Object.assign(mergeConfigs([␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, false),␊
        loadCachedModule(cache, "~/test/fixtures/compare", "~/test/fixtures/compare/extended-by-babelrc.js", envName, undefined, true),␊
        {␊
          sourceMaps: false,␊
          plugins: [␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.1.foo"␊
              },␊
              name: "🤡🎪🎟.0"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.2.foo"␊
              },␊
              name: "plugin@babelrc.2"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin/index.js",␊
              options: {␊
                label: "plugin@babelrc.3"␊
              },␊
              name: "plugin@babelrc.3"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/env-plugin/index.js",␊
              options: {␊
                label: "env-plugin@babelrc.foo"␊
              },␊
              name: "plugin@babelrc.foo"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/plugin-default-opts/index.js",␊
              name: "🤡🎪🎟.2"␊
            }␊
          ],␊
          presets: [␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",␊
              options: {␊
                label: "preset@babelrc"␊
              },␊
              name: "preset@babelrc"␊
            },␊
            {␊
              filename: "~/test/fixtures/compare/node_modules/preset/index.js",␊
              options: {␊
                label: "preset@babelrc.foo"␊
              },␊
              name: "preset@babelrc.foo"␊
            }␊
          ]␊
        }␊
      ]), {␊
        babelrc: false,␊
        envName,␊
        overrides: [␊
    ␊
        ]␊
      })␊
    }␊
    ␊
    exports.getOptions = (envName, cache) => {␊
      if (typeof envName !== "string") {␊
        envName = process.env.BABEL_ENV || process.env.NODE_ENV || "development"␊
      }␊
      return envName in envOptions␊
        ? envOptions[envName](envName, cache)␊
        : defaultOptions(envName, cache)␊
    }␊
    `
